"use strict";(self.webpackChunkjouwweb=self.webpackChunkjouwweb||[]).push([[6370],{40797:function(e,n,t){t.d(n,{T:function(){return r}});let r=function(e){return e.Image="image",e.Video="video",e}({})},74595:function(e,n,t){t.d(n,{C3:function(){return u},GC:function(){return a},Hb:function(){return c},IM:function(){return p},VF:function(){return o},bq:function(){return f},lu:function(){return s},qN:function(){return l}});var r=t(89013),i=t(33874),d=t(12419);const c=(0,i.as)("bricks/data/delete",(async(e,n)=>{let{getState:t}=n;const{brickIds:i,recursive:c}=e;await(0,r.ty)((0,d.g)(t(),"element/delete"),{elements:i,recursive:c})})),o=(0,i.as)("bricks/data/load",(async(e,n)=>{let{getState:t}=n;return(0,r.xE)((0,d.g)(t(),"element/model"),{element:e})})),a=(0,i.as)("bricks/data/duplicate",(async(e,n)=>{let{getState:t}=n;return(0,r.xE)((0,d.g)(t(),"element/duplicate"),{original:e})})),s=(0,i.as)("bricks/data/move",(async(e,n)=>{let{getState:t}=n;const{brickIds:i,target:c}=e,o="tree"===c.type?{type:"tree",parent:c.parentBrickId,after:c.afterBrickId??null}:{type:"page",page:c.pageId,position:c.position};await(0,r.ty)((0,d.g)(t(),"element/move"),{elements:i,location:o})})),l=(0,i.as)("bricks/data/split-strip",(async(e,n)=>{let{getState:t}=n;return await(0,r.ty)((0,d.g)(t(),"element/split-strip"),e)}));let u=function(e){return e.BEFORE="before",e.AFTER="after",e}({});const f=(0,i.as)("bricks/data/merge-strip",(async(e,n)=>{let{getState:t}=n;return await(0,r.ty)((0,d.g)(t(),"element/merge-strip"),e)})),p=(0,i.as)("bricks/data/insert-brick-dto",(async(e,n)=>{let{getState:t}=n;const{brick:i,parentBrickId:c,afterBrickId:o,...a}=e;return(0,r.xE)((0,d.g)(t(),"element/insert"),{parent:c,after:o,brick:JSON.stringify(i),...a})}))},12419:function(e,n,t){t.d(n,{g:function(){return i}});var r=t(57259);function i(e,n){const{segmentType:t,segmentId:i}=e.editor.child;return`/v2/website/${r.default.website.id}/${t}/${i}/${n}`}},52890:function(e,n,t){t.d(n,{D:function(){return o}});var r=t(33874),i=t(74234),d=t(68426),c=t(74595);const o=(0,r.as)("bricks/reload",(async(e,n)=>{let{getState:t,dispatch:r}=n;if(!(0,d.vd)(t(),e))throw new Error("Cannot reload brick that does not exist");const o=await r((0,c.VF)(e)).unwrap();return r((0,i.ix)(o.bricks)),o}))},61030:function(e,n,t){t.d(n,{R:function(){return h}});var r=t(93513),i=t(57690),d=t(57688),c=t(87421),o=t(89013),a=t(68426),s=t(12419);const l=new Map,u=e=>async n=>{(0,d.Z)(window===window.top,"apiUpdateBrickDebounced can only be executed in the parent-frame");const{brickId:t,brickModelUpdates:r,mergeBrickModelUpdates:i=((e,n)=>({...e,...n})),immediate:u=!1}=e,f=l.get(t)??{brickModelUpdates:{},promiseWithResolvers:Promise.withResolvers(),debouncedApiUpdateBrick:(0,c.Z)((()=>{l.delete(t),n((e=>async(n,t)=>{const{brickId:r,brickModelUpdates:i}=e,d=(0,a.vd)(t(),r);if(!d)return!1;let c=d.type;["album-gallery","album-raster"].includes(c)&&(c="album"),"image-text"!==d.type||"text"in i||(c="image"),Object.entries(i).forEach((e=>{let[n,t]=e;null===t&&(i[n]="")}));try{return await(0,o.nv)((0,s.g)(t(),`${c}/update`),{id:r,...i}),!0}catch(e){if(e instanceof o.MH&&404===e.responseStatus)return!1;throw e}})({brickId:t,brickModelUpdates:f.brickModelUpdates})).then(f.promiseWithResolvers.resolve).catch((e=>f.promiseWithResolvers.reject(e)))}),1e3)};return l.set(t,f),f.brickModelUpdates=i(f.brickModelUpdates,r),f.debouncedApiUpdateBrick(),u&&f.debouncedApiUpdateBrick.flush(),await f.promiseWithResolvers.promise};var f=t(93367),p=t(33874),k=t(74234);const h=(0,p.as)("bricks/update",(async(e,n)=>{let{getState:t,dispatch:i}=n;(0,d.Z)(window===window.top,"updateBrick can only be executed in the parent-frame");const{brickId:c,brickModelUpdates:o,transformUpdatesForApi:s=(e=>e),immediate:l}=e;if(!(0,a.vd)(t(),c))throw new Error("Brick does not exist");i((0,k.QB)({brickId:c,brickModelUpdates:o}));const u=await i(b({brickId:c,brickModelUpdates:(0,r.Uy)(o,s),immediate:l}));return u||console.debug(`Ignored API update for deleted brick ${c}.`),u})),b=e=>async(n,t)=>{const{brickId:r,brickModelUpdates:c,...o}=e,s=(0,a.vd)(t(),r);if((0,d.Z)(null!==s),"column"===s.type){const e=(0,a._G)(t(),r);return await n(u({brickId:e,brickModelUpdates:{columnUpdates:{[r]:c}},mergeBrickModelUpdates:(e,n)=>(0,i.Z)(e,n),...o}))}return await n(u({brickId:r,brickModelUpdates:c,...o}))};window===window.top&&(0,f.f)({updateBrick:h})},74234:function(e,n,t){t.d(n,{IS:function(){return p},QB:function(){return I},QJ:function(){return w},TJ:function(){return k},VE:function(){return v},Zn:function(){return y},ix:function(){return u},j2:function(){return l},k7:function(){return g},rS:function(){return b},sM:function(){return f},yn:function(){return m}});var r=t(77655),i=t(44176),d=t(57688),c=t(61030),o=t(52890),a=t(71885);const s=(0,r.oM)({name:"bricks",initialState:{entities:{},parents:{},inserting:{}},reducers:{initialize(e,n){return{entities:Object.fromEntries(n.payload.map((e=>[e.id,{...e}]))),parents:Object.fromEntries(n.payload.flatMap((e=>(0,a.Zo)(e)?e.children.map((n=>[n,e.id])):[]))),inserting:{}}},loadBricks(e,n){n.payload.forEach((n=>{const t=e.entities[n.id];t?(t.model=n.model,(0,a.Zo)(t)&&(0,a.Zo)(n)&&(t.children=n.children),(0,a.aI)(n)&&((0,d.Z)((0,a.aI)(t),`Cannot update legacy HTML for non-legacy brick ${t.id}`),t.initialHtml=n.initialHtml,t.initialHtmlVersion=(t.initialHtmlVersion||0)+1)):e.entities[n.id]=n,(0,a.Zo)(n)&&n.children.forEach((t=>{e.parents[t]=n.id}))}))},unloadBrick(e,n){const t=n.payload,r=n=>{const t=e.entities[n];t&&((0,a.Zo)(t)&&t.children.filter((t=>e.parents[t]===n)).forEach(r),s.caseReducers.removeChild(e,s.actions.removeChild(t.id)),delete e.entities[n],delete e.parents[n],delete e.inserting[n])};r(t)},insertChild(e,n){const{brickId:t,parentBrickId:r,afterBrickId:i}=n.payload,d=e.entities[t];if(!d)throw new Error(`Invalid brick: ${t}`);const c=e.entities[r];if(!(0,a.Zo)(c))throw new Error(`Invalid parent brick: ${r}`);s.caseReducers.removeChild(e,s.actions.removeChild(d.id)),e.parents[t]=r;const o=i?c.children.indexOf(i):-1;c.children.splice(o+1,0,t)},insertChildren(e,n){const{brickIds:t,parentBrickId:r}=n.payload;let{afterBrickId:i=null}=n.payload;for(const n of t)s.caseReducers.insertChild(e,s.actions.insertChild({brickId:n,parentBrickId:r,afterBrickId:i})),i=n},removeChild(e,n){const t=n.payload;if(!e.entities[t])throw new Error(`Invalid brick: ${t}`);const r=e.parents[t];if(!r)return;delete e.parents[t];const i=e.entities[r];if(!i||!(0,a.Zo)(i))throw new Error(`Invalid parent brick: ${r}`);i.children=i.children.filter((e=>e!==t))},replaceChild(e,n){const{parentBrickId:t,oldBrickId:r,newBrickIds:i}=n.payload,d=e.entities[t];if(!(0,a.Zo)(d))throw new Error(`Invalid parent brick: ${t}`);d.children=d.children.map((e=>e===r?i:e)).flat(),i.forEach((n=>{e.parents[n]=t}))},updateModel(e,n){const{brickId:t,brickModelUpdates:r}=n.payload;!function(e,n){n&&(e.model={...e.model,...n})}(e.entities[t],r)},queueFiles(e,n){const{brickId:t,files:r}=n.payload,i=e.entities[t];if(!i)throw new Error(`Invalid parent brick: ${t}`);const d=i.pendingFiles??[];i.pendingFiles=[...d,...r]},dequeueFiles(e,n){const{brickId:t,files:r}=n.payload,d=e.entities[t];if(!d)throw new Error(`Invalid parent brick: ${t}`);const c=d.pendingFiles??[];d.pendingFiles=(0,i.Z)(c,r)},insertLoader(e,n){const{requestId:t,parentBrickId:r,afterBrickId:i}=n.payload;r in e.inserting||(e.inserting[r]=[]),e.inserting[r].push({afterBrickId:i??null,requestId:t})},removeLoader(e,n){const{requestId:t,parentBrickId:r}=n.payload;r in e.inserting&&(e.inserting[r]=e.inserting[r].filter((e=>{let{requestId:n}=e;return n!==t})),0===e.inserting[r].length&&delete e.inserting[r])},replaceLoader(e,n){const{requestId:t,parentBrickId:r,brickId:i,bricks:d}=n.payload,c=e.inserting[r].find((e=>e.requestId===t));if(!c)return;const{afterBrickId:o}=c;s.caseReducers.loadBricks(e,s.actions.loadBricks(d)),s.caseReducers.insertChild(e,s.actions.insertChild({brickId:i,parentBrickId:r,afterBrickId:o})),s.caseReducers.removeLoader(e,s.actions.removeLoader({requestId:t,parentBrickId:r}));const a=(new Date).getTime();e.parents[i]=r,d.forEach((n=>{e.entities[n.id].insertedAt=a})),e.entities[i].requestId=t}},extraReducers:e=>{e.addCase(o.D.pending,((e,n)=>{const{arg:t,requestId:r}=n.meta,i=e.entities[t];(0,d.Z)(i,`Could not find brick ${t}`),i.loadingRequestIds??=[],i.loadingRequestIds.push(r)})).addCase(o.D.fulfilled,((e,n)=>{const{arg:t,requestId:r}=n.meta,i=e.entities[t];(0,d.Z)(i,`Could not find brick ${t}`),i.loadingRequestIds=i.loadingRequestIds?.filter((e=>e!==r))})).addCase(c.R.pending,((e,n)=>{const{arg:{brickId:t},requestId:r}=n.meta,i=e.entities[t];(0,d.Z)(i,`Could not find brick ${t}`),i.savingRequestIds??=[],i.savingRequestIds.push(r)})).addCase(c.R.fulfilled,((e,n)=>{const{arg:{brickId:t},requestId:r}=n.meta,i=e.entities[t];i&&(i.savingRequestIds=i.savingRequestIds?.filter((e=>e!==r)))}))}}),{initialize:l,loadBricks:u,unloadBrick:f,insertChild:p,insertChildren:k,removeChild:h,replaceChild:b,updateModel:I,queueFiles:m,dequeueFiles:g,insertLoader:w,removeLoader:y,replaceLoader:v}=s.actions,{caseReducers:B}=s;n.ZP=s.reducer},68426:function(e,n,t){t.d(n,{$n:function(){return k},Ae:function(){return B},Gb:function(){return w},Il:function(){return b},Jz:function(){return u},Km:function(){return v},Nr:function(){return m},Wu:function(){return p},Z2:function(){return y},_G:function(){return l},nA:function(){return I},p3:function(){return E},vd:function(){return s},y_:function(){return g}});var r=t(19119),i=t(42454),d=t(57688),c=t(71885);const o=[],a=e=>e.editor.bricks,s=(0,r.P1)([a,(e,n)=>n],((e,n)=>e.entities[n]??null)),l=(e,n)=>u(e,n)?.id??null,u=(0,r.P1)([a,(e,n)=>n],((e,n)=>{const t=e.parents[n]??null;if(null===t)return null;const r=e.entities[t]??null;return(0,d.Z)(null!==r,"Parent brick entity does not exist"),(0,d.Z)((0,c.Zo)(r),"Parent brick is not a parent brick?!"),r})),f=(0,r.P1)([a,(e,n)=>n],((e,n)=>{for(;n in e.parents;)n=e.parents[n];return n}));function p(e,n,t){let r=s(e,n);for(;r&&r.type!==t;)r=u(e,r.id);return r}const k=(e,n)=>{const t=s(e,n);if(!t)return 0;if(!(0,c.Zo)(t))return 1;let r=0;return t.children.forEach((n=>{r+=k(e,n)})),r};const h=(0,i.Z)(((e,n)=>({name:e,pinned:n})),((e,n)=>`${e}-${n}`));function b(e,n){const t=f(e,n),r=function(){if(window.parent!==window)return window;const e=document.querySelector("#editor-frame");return e?.contentWindow??null}();if(!r)return null;const i=r.JOUWWEB.editor.block,d=[{elementId:i.children.content?.children.child?.renderData.id,name:c.jz.CONTENT,pinned:!1},{elementId:i.children.content?.children.child?.children.productElement?.renderData.id,name:c.jz.CONTENT,pinned:!1},{elementId:i.children.content?.children.child?.children.postElement?.renderData.id,name:c.jz.CONTENT,pinned:!1},{elementId:i.children.footer?.children.child?.renderData.id,name:c.jz.FOOTER,pinned:!0},{elementId:i.children.sidebar?.children.child?.renderData.id,name:c.jz.SIDEBAR,pinned:!1},{elementId:i.children.sidebar?.children.pinnedChild?.renderData.id,name:c.jz.SIDEBAR,pinned:!0}].find((e=>e.elementId===t));return d?h(d.name,d.pinned):null}const I=(e,n)=>{const t=l(e,n);if(null===t)throw new Error(`Brick ${n} has no parent; can't select siblings`);const r=s(e,t);if(!r)throw new Error(`Parent brick (ID: ${t}) not found`);if(!(0,c.Zo)(r))throw new Error(`Parent brick (ID: ${t}) is not a ParentBrick`);const i=null===n?-1:r.children.indexOf(n);return 0<=i-1?r.children[i-1]:null},m=(e,n)=>{const t=l(e,n);if(null===t)throw new Error(`Brick ${n} has no parent; can't select siblings`);const r=s(e,t);if(!r)throw new Error(`Parent brick (ID: ${t}) not found`);if(!(0,c.Zo)(r))throw new Error(`Parent brick (ID: ${t}) is not a ParentBrick`);const i=null===n?-1:r.children.indexOf(n);return i+1<r.children.length?r.children[i+1]:null},g=(e,n)=>{const t=s(e,n);return t&&(0,c.Zo)(t)&&0!==t.children.length?t.children[0]:null},w=(e,n)=>{const t=s(e,n);return t&&(0,c.Zo)(t)&&0!==t.children.length?t.children[t.children.length-1]:null},y=(0,r.P1)([u],(e=>null===e)),v=(0,r.P1)([s,y],((e,n)=>null!==e&&!n)),B=(0,r.P1)([a,(e,n)=>e.editor.bricks.inserting[n]??o,s],((e,n,t)=>{if(!t||!(0,c.Zo)(t))return o;let r=t.children.map((n=>{const r=s.resultFunc(e,n);return(0,d.Z)(r,`Could not find child ${n} of brick ${t.id}.`),{key:r.requestId??r.id,brickId:r.id}}));return n.forEach((e=>{let{afterBrickId:n,requestId:t}=e;const i=r.findIndex((e=>e.brickId&&e.brickId===n))+1;r=[...r.slice(0,i),{key:t},...r.slice(i)]})),r=r.map(((e,n)=>({...e,isFirstChild:0===n,isLastChild:n===r.length-1}))),r})),E=(e,n,t)=>{for(;t!==n;){if(null===t)return!1;t=l(e,t)}return!0}},71885:function(e,n,t){t.d(n,{KD:function(){return i},QE:function(){return o},Zo:function(){return a},aI:function(){return s},iO:function(){return d},jz:function(){return r},nA:function(){return c},v4:function(){return l}});let r=function(e){return e.CONTENT="content",e.SIDEBAR="sidebar",e.FOOTER="footer",e}({});function i(e){return"simple-root"===e||"column"===e||"strip"===e||"box"===e}function d(e){return"simple-root"===e||"strip"===e}function c(e){return!function(e){return i(e)||"columns"===e||"strip-root"===e}(e)}function o(e){return i(e.type)}function a(e){return"children"in e}function s(e){return"initialHtml"in e}function l(e){return!e.children||0===e.children.length}},33874:function(e,n,t){t.d(n,{CG:function(){return c},TL:function(){return d},as:function(){return o}});var r=t(77655),i=t(45007);const d=i.I0.withTypes(),c=i.v9.withTypes(),o=r.hg.withTypes()},57688:function(e,n,t){function r(e){if(!e)throw new Error(`Assertion Error: ${arguments.length>1&&void 0!==arguments[1]?arguments[1]:"no additional info provided"}`)}t.d(n,{Z:function(){return r}})}}]);
//# sourceMappingURL=6370.a8af00dc95f795906f04.js.map